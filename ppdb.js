(()=>{const e=document,t=e.querySelector(".ppdb-form"),r=e.querySelectorAll(".progress-step"),o=e.querySelector(".progress-line"),a="ppdbFormData",n=(e,r=t)=>[...r.querySelectorAll(e)],s=()=>{const e=(()=>{const e={},r=n(".form-step:not(.form-success)"),o=t.querySelector(".form-success"),a=Array.from(r).indexOf(o?.previousElementSibling);return r.forEach(((t,r)=>{if(r!==a){const r=t.querySelector("h3")?.textContent.trim();r&&(e[r]={},n(".form-group",t).forEach((t=>{const o=t.querySelector(".form-label")?.textContent.trim(),a=t.querySelector("input, textarea, select");if(o&&a&&"file"!==a.type){const n="radio"===a.type?t.querySelector("input[type='radio']:checked")?.value:a.value.trim();n&&(e[r][o]=n)}})))}})),e})();var r;const o=`https://wa.me/${(r=configPPDB.nomorWhatsapp).startsWith("08")?`62${r.slice(1)}`:r}?text=${(e=>{let t=`${configPPDB.messageWhatsapp}\n\n`;for(const[r,o]of Object.entries(e)){t+=`======= ${r.toUpperCase()} =======\n`;for(const[e,r]of Object.entries(o))t+=`*${e}*: ${r}\n`;t+="\n"}return encodeURIComponent(t)})(e)}`;window.open(o,"_blank")},i=()=>{const e=t.querySelector(".form-step.active"),r=n("input, textarea, select",e);let o=!0;return r.forEach((e=>{const t=e.checkValidity();e.classList.toggle("is-invalid",!t),!t&&o&&(e.scrollIntoView({behavior:"smooth",block:"center"}),o=!1)})),o},c=e=>{const t=r.length-1,a=Math.min(e,t);r.forEach(((e,t)=>e.classList.toggle("active",t<=a))),o.style.width=a/t*100+"%"},l=()=>{const e=t.querySelector(".form-step.active");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},p=async e=>{if(e.preventDefault(),!configPPDB.appsScript||!configPPDB.appsScript.startsWith("https://script.google.com/"))return void s();if(!i())return;const o=t.querySelector(".btn-submit"),p=o.innerHTML;o.innerHTML='<span class="spinner-border spinner-border-sm"></span> Mengirim...',o.disabled=!0;const m=n("input[type='file']");try{const e=e=>new Promise((t=>{if(0===e.files.length)return void t(null);const r=e.files[0],o=new FileReader;o.addEventListener("loadend",(()=>{const a=o.result.split("base64,")[1];t({fieldName:e.name,base64:a,type:r.type,name:r.name})})),o.readAsDataURL(r)})),n=Array.from(m).map(e),s=(await Promise.all(n)).filter(Boolean),i=new FormData(t);i.append("files",JSON.stringify(s));if((await fetch(configPPDB.appsScript,{method:"POST",body:i})).ok){const e=t.querySelector(".form-step.active"),o=t.querySelector(".form-success");e&&o&&(e.classList.remove("active"),o.classList.add("active"),c(r.length),l(),localStorage.removeItem(a))}}catch(e){}finally{o.innerHTML=p,o.disabled=!1}},m=e=>{e.target.matches(".form-control-number")&&(e.target.value=e.target.value.replace(/\D/g,"")),e.target.classList.toggle("is-invalid",""===e.target.value.trim()),(()=>{const e={};n("input, textarea, select").forEach((t=>{"file"!==t.type&&("radio"===t.type&&t.checked||"radio"!==t.type)&&(e[t.name]=t.value)})),localStorage.setItem(a,JSON.stringify(e))})()},f=e=>e.target.classList.add("is-invalid"),d=()=>{const r=t.querySelector(".ppdb-table"),o=e.createElement("table");o.classList.add("table","table-basic","table-bordered");const a=e.createElement("tbody");n(".form-step:not(.active) .form-group").forEach((t=>{const r=t.querySelector(".form-label")?.textContent.trim(),o=t.querySelector("input, textarea, select");let n="";if("file"===o?.type){const e=o.files;e.length>0&&(n=e[0].name)}else n="radio"===o?.type?t.querySelector("input[type='radio']:checked")?.nextElementSibling.textContent.trim():o?.value.trim();if(r&&n){const t=e.createElement("tr");t.innerHTML=`<td>${r}</td><td>${n}</td>`,a.appendChild(t)}})),o.appendChild(a),r.innerHTML="",r.appendChild(o)};n("label:not(.form-check-label)").forEach((e=>e.classList.add("form-label"))),n("input:not(.form-check-input), textarea").forEach((e=>e.classList.add("form-control"))),n("input").forEach((e=>e.hasAttribute("type")||e.setAttribute("type","text"))),n(".form-control-number").forEach((e=>e.setAttribute("inputmode","numeric"))),n("input[data-example], textarea[data-example]").forEach((e=>e.setAttribute("placeholder",e.dataset.example))),n(".form-select").forEach((t=>{const r=t.getAttribute("aria-label")||"Pilih Opsi",o=e.createElement("option");o.textContent=r,o.setAttribute("value",""),o.setAttribute("selected",""),t.prepend(o)})),n(".form-select option:not(:first-child)").forEach((e=>e.value=e.value||e.textContent.trim())),n(".form-group:not(.optional) input, .form-group:not(.optional) textarea, .form-group:not(.optional) select").forEach((e=>e.setAttribute("required",""))),n(".form-group").forEach((e=>{const t=e.querySelector("label"),r=e.querySelector("input:not([type='radio']), textarea, select");if(t&&r){const e=t.textContent.trim().toUpperCase().replace(/\s+/g,"_");r.setAttribute("name",e),t.setAttribute("for",e),r.setAttribute("id",e)}})),(()=>{const e=JSON.parse(localStorage.getItem(a));e&&n("input, textarea, select").forEach((t=>{"file"!==t.type&&e[t.name]&&("radio"===t.type&&t.value===e[t.name]?t.checked=!0:"radio"!==t.type&&(t.value=e[t.name]))}))})(),t.addEventListener("click",(e=>{const r=e.target.closest(".btn-next, .btn-prev, .btn-confirm");r&&(r.matches(".btn-next")?(()=>{if(!i())return;const e=t.querySelector(".form-step.active"),r=e.nextElementSibling;if(r?.classList.contains("form-step")){e.classList.remove("active"),r.classList.add("active");const o=Array.from(t.querySelectorAll(".form-step")).indexOf(r);c(o),l(),r.nextElementSibling?.classList.contains("form-success")&&d()}})():r.matches(".btn-prev")?(()=>{const e=t.querySelector(".form-step.active"),r=e.previousElementSibling;if(r?.classList.contains("form-step")){e.classList.remove("active"),r.classList.add("active");const o=Array.from(t.querySelectorAll(".form-step")).indexOf(r);c(o),l()}})():r.matches(".btn-confirm")&&s())})),t.addEventListener("submit",p),t.addEventListener("input",m),t.addEventListener("invalid",f,!0),setTimeout((()=>{t.classList.add("show"),e.querySelector(".ppdb-load")?.remove()}),1e3)})();
