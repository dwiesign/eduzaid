(()=>{const e=document,t=e.querySelector(".ppdb-form"),r=e.querySelector(".ppdb-progress"),o=e.querySelectorAll(".progress-step"),a=e.querySelector(".progress-line"),n="ppdbFormData",s=(e,r=t)=>[...r.querySelectorAll(e)],i=()=>{const e=(()=>{const e={},r=s(".form-step:not(.form-success)"),o=t.querySelector(".form-success"),a=Array.from(r).indexOf(o?.previousElementSibling);return r.forEach(((t,r)=>{if(r!==a){const r=t.querySelector("h3")?.textContent.trim();r&&(e[r]={},s(".form-group",t).forEach((t=>{const o=t.querySelector(".form-label")?.textContent.trim(),a=t.querySelector("input, textarea, select");if(o&&a&&"file"!==a.type){const n="radio"===a.type?t.querySelector("input[type='radio']:checked")?.value:a.value.trim();n&&(e[r][o]=n)}})))}})),e})();var r;const o=`https://wa.me/${(r=configPPDB.nomorWhatsapp).startsWith("08")?`62${r.slice(1)}`:r}?text=${(e=>{let t=`${configPPDB.messageWhatsapp}\n\n`;for(const[r,o]of Object.entries(e)){t+=`======= ${r.toUpperCase()} =======\n`;for(const[e,r]of Object.entries(o))t+=`*${e}*: ${r}\n`;t+="\n"}return encodeURIComponent(t)})(e)}`;window.open(o,"_blank")},c=()=>{const e=t.querySelector(".form-step.active"),r=s("input, textarea, select",e);let o=!0;return r.forEach((e=>{const t=e.checkValidity();e.classList.toggle("is-invalid",!t),!t&&o&&(e.scrollIntoView({behavior:"smooth",block:"center"}),o=!1)})),o},l=e=>{const t=o.length-1,r=Math.min(e,t);o.forEach(((e,t)=>e.classList.toggle("active",t<=r))),a.style.width=r/t*100+"%"},p=()=>{const e=t.querySelector(".form-step.active");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},m=async e=>{if(e.preventDefault(),!configPPDB.appsScript||!configPPDB.appsScript.startsWith("https://script.google.com/"))return void i();if(!c())return;const r=t.querySelector(".btn-submit"),a=r.innerHTML;r.innerHTML='<span class="spinner-border spinner-border-sm"></span> Mengirim...',r.disabled=!0;const m=s("input[type='file']"),u=t.querySelector("input:not([type='file'])"),f=u?u.value.trim().replace(/\s+/g,"_"):"Unknown";try{const e=e=>new Promise((t=>{if(0===e.files.length)return void t(null);const r=e.files[0],o=new FileReader;o.addEventListener("loadend",(()=>{const a=o.result.split("base64,")[1],n=`${f}_${e.name}`;t({fieldName:e.name,base64:a,type:r.type,name:n})})),o.readAsDataURL(r)})),s=Array.from(m).map(e),i=(await Promise.all(s)).filter(Boolean),c=new FormData(t);c.append("files",JSON.stringify(i));if((await fetch(configPPDB.appsScript,{method:"POST",body:c})).ok){const e=t.querySelector(".form-step.active"),r=t.querySelector(".form-success");e&&r&&(e.classList.remove("active"),r.classList.add("active"),l(o.length),p(),localStorage.removeItem(n))}}catch(e){}finally{r.innerHTML=a,r.disabled=!1}},u=e=>{e.target.matches(".form-control-number")&&(e.target.value=e.target.value.replace(/\D/g,"")),e.target.classList.toggle("is-invalid",""===e.target.value.trim()),(()=>{const e={};s("input, textarea, select").forEach((t=>{"file"!==t.type&&("radio"===t.type&&t.checked||"radio"!==t.type)&&(e[t.name]=t.value)})),localStorage.setItem(n,JSON.stringify(e))})()},f=e=>e.target.classList.add("is-invalid"),d=()=>{const r=t.querySelector(".ppdb-table"),o=e.createElement("table");o.classList.add("table","table-basic","table-bordered");const a=e.createElement("tbody");s(".form-step:not(.active) .form-group").forEach((t=>{const r=t.querySelector(".form-label")?.textContent.trim(),o=t.querySelector("input, textarea, select");let n="";if("file"===o?.type){const e=o.files;e.length>0&&(n=e[0].name)}else n="radio"===o?.type?t.querySelector("input[type='radio']:checked")?.nextElementSibling.textContent.trim():o?.value.trim();if(r&&n){const t=e.createElement("tr");t.innerHTML=`<td>${r}</td><td>${n}</td>`,a.appendChild(t)}})),o.appendChild(a),r.innerHTML="",r.appendChild(o)};s("label:not(.form-check-label)").forEach((e=>e.classList.add("form-label"))),s("input:not(.form-check-input), textarea").forEach((e=>e.classList.add("form-control"))),s("input").forEach((e=>e.hasAttribute("type")||e.setAttribute("type","text"))),s(".form-control-number").forEach((e=>e.setAttribute("inputmode","numeric"))),s("input[data-example], textarea[data-example]").forEach((e=>e.setAttribute("placeholder",e.dataset.example))),s(".form-select").forEach((t=>{const r=t.getAttribute("aria-label")||"Pilih Opsi",o=e.createElement("option");o.textContent=r,o.setAttribute("value",""),o.setAttribute("selected",""),t.prepend(o)})),s(".form-select option:not(:first-child)").forEach((e=>e.value=e.value||e.textContent.trim())),s(".form-group:not(.optional) input, .form-group:not(.optional) textarea, .form-group:not(.optional) select").forEach((e=>e.setAttribute("required",""))),s(".form-group").forEach((e=>{const t=e.querySelector("label"),r=e.querySelector("input:not([type='radio']), textarea, select");if(t&&r){const e=t.textContent.trim().toUpperCase().replace(/\s+/g,"_");r.setAttribute("name",e),t.setAttribute("for",e),r.setAttribute("id",e)}})),(()=>{const e=JSON.parse(localStorage.getItem(n));e&&s("input, textarea, select").forEach((t=>{"file"!==t.type&&e[t.name]&&("radio"===t.type&&t.value===e[t.name]?t.checked=!0:"radio"!==t.type&&(t.value=e[t.name]))}))})(),t.addEventListener("click",(e=>{const r=e.target.closest(".btn-next, .btn-prev, .btn-confirm");r&&(r.matches(".btn-next")?(()=>{if(!c())return;const e=t.querySelector(".form-step.active"),r=e.nextElementSibling;if(r?.classList.contains("form-step")){e.classList.remove("active"),r.classList.add("active");const o=Array.from(t.querySelectorAll(".form-step")).indexOf(r);l(o),p(),r.nextElementSibling?.classList.contains("form-success")&&d()}})():r.matches(".btn-prev")?(()=>{const e=t.querySelector(".form-step.active"),r=e.previousElementSibling;if(r?.classList.contains("form-step")){e.classList.remove("active"),r.classList.add("active");const o=Array.from(t.querySelectorAll(".form-step")).indexOf(r);l(o),p()}})():r.matches(".btn-confirm")&&i())})),t.addEventListener("submit",m),t.addEventListener("input",u),t.addEventListener("invalid",f,!0),setTimeout((()=>{r.classList.remove("d-none"),t.classList.replace("d-none","show"),e.querySelector(".ppdb-load")?.remove()}),1e3)})();
